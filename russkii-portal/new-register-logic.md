# НОВАЯ ЛОГИКА РЕГИСТРАЦИИ

## Проблема сейчас:
1. Пользователь заполняет форму
2. **СРАЗУ создается в users** ❌
3. Отправляется на подтверждение телефона
4. Если перезагрузит страницу - потеря контекста

## Правильная логика:
1. Пользователь заполняет форму
2. **Сохраняется ТОЛЬКО в pending_registrations** ✅
3. Возвращается токен верификации
4. Telegram бот подтверждает телефон
5. **ТОЛЬКО ТОГДА создается в users** ✅
6. Автоматический логин

## Что нужно изменить:

### 1. `/api/auth/register` endpoint:
- НЕ создавать пользователя в users
- Сохранять в pending_registrations
- Возвращать токен

### 2. `/api/auth/check-phone-verification` endpoint:
- Проверять pending_registrations
- Если verified=1, СОЗДАВАТЬ пользователя в users
- Автоматически логинить
- Удалять из pending_registrations

### 3. Telegram бот:
- Обновлять pending_registrations.verified = 1
- НЕ создавать пользователя в users

### 4. Фронтенд:
- После подтверждения телефона автоматически логинить

## Преимущества:
✅ Нет дублирования пользователей
✅ Можно перезагружать страницу
✅ Чистая архитектура
✅ Никаких конфликтов 