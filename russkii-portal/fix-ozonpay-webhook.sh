#!/bin/bash

echo "üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Ozon Pay Webhook URL..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–π webhook URL
echo "üìã –¢–µ–∫—É—â–∏–π webhook URL –≤ .env:"
grep OZONPAY_WEBHOOK_URL .env || echo "‚ùå OZONPAY_WEBHOOK_URL –Ω–µ –Ω–∞–π–¥–µ–Ω"

# –°–æ–∑–¥–∞–µ–º –±—ç–∫–∞–ø .env —Ñ–∞–π–ª–∞
cp .env .env.backup.$(date +%Y%m%d_%H%M%S)
echo "üíæ –°–æ–∑–¥–∞–Ω –±—ç–∫–∞–ø .env —Ñ–∞–π–ª–∞"

# –ò—Å–ø—Ä–∞–≤–ª—è–µ–º webhook URL
if grep -q "OZONPAY_WEBHOOK_URL" .env; then
    # –ó–∞–º–µ–Ω—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å—Ç—Ä–æ–∫—É
    sed -i 's|OZONPAY_WEBHOOK_URL=.*|OZONPAY_WEBHOOK_URL=https://helens-jungle.ru/api/ozonpay/webhook|' .env
    echo "‚úÖ OZONPAY_WEBHOOK_URL –æ–±–Ω–æ–≤–ª–µ–Ω"
else
    # –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä–æ–∫—É
    echo "OZONPAY_WEBHOOK_URL=https://helens-jungle.ru/api/ozonpay/webhook" >> .env
    echo "‚úÖ OZONPAY_WEBHOOK_URL –¥–æ–±–∞–≤–ª–µ–Ω"
fi

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
echo ""
echo "üìã –ù–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ webhook URL:"
grep OZONPAY_WEBHOOK_URL .env

echo ""
echo "üö® –í–ê–ñ–ù–û: –¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å webhook URL –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ Ozon Bank!"
echo "   1. –í–æ–π–¥–∏—Ç–µ –≤ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –±–∞–Ω–∫–∞"
echo "   2. –ù–∞–π–¥–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—ç–∫–≤–∞–π—Ä–∏–Ω–≥–∞"
echo "   3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ webhook URL: https://helens-jungle.ru/api/ozonpay/webhook"
echo ""
echo "üìû –¢–∞–∫–∂–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫—É Ozon Bank:"
echo "   - –°–æ–æ–±—â–∏—Ç—å –æ –ø—Ä–æ–±–ª–µ–º–µ '–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤'"
echo "   - –ü–æ–ø—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç–∏–≤–∞—Ü–∏—é API"
echo "   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –æ–¥–æ–±—Ä–µ–Ω–∞"
echo ""
echo "üí∞ –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–¥–µ–ª–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂ 10+ —Ä—É–±–ª–µ–π –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
echo ""
echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π..."
pm2 restart russkii-portal || echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ PM2"

echo "‚úÖ –°–∫—Ä–∏–ø—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!" 