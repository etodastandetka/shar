#!/bin/bash

echo "üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Ozon Pay"
echo ""

# 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
echo "üìã –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Ozon Pay:"
grep OZONPAY_ .env

echo ""
echo "üîß –ò—Å–ø—Ä–∞–≤–ª—è–µ–º webhook URL..."
sed -i 's|OZONPAY_WEBHOOK_URL=https://helens-jungle.ru/unique-id|OZONPAY_WEBHOOK_URL=https://helens-jungle.ru/api/ozonpay/webhook|' .env

echo ""
echo "‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:"
grep OZONPAY_WEBHOOK_URL .env

echo ""
echo "üîÑ –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º –ø—Ä–æ–µ–∫—Ç..."
npm run build

echo ""
echo "‚ôªÔ∏è –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä..."
pm2 restart russkii-portal

echo ""
echo "‚è≥ –ñ–¥–µ–º 3 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞..."
sleep 3

echo ""
echo "üìã –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞..."
pm2 status russkii-portal

echo ""
echo "üìÑ –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏:"
pm2 logs russkii-portal --lines 5

echo ""
echo "‚úÖ –ì–æ—Ç–æ–≤–æ!"
echo ""
echo "üîó –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –æ–±–Ω–æ–≤–∏—Ç–µ –≤ –õ–ö Ozon –ë–∞–Ω–∫–∞:"
echo "   1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: –ú–∞–≥–∞–∑–∏–Ω ‚Üí –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è"
echo "   2. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à —Ç–æ–∫–µ–Ω –∏ –Ω–∞–∂–º–∏—Ç–µ '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å'"
echo "   3. –û–±–Ω–æ–≤–∏—Ç–µ URL –¥–ª—è POST-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:"
echo "      https://helens-jungle.ru/api/ozonpay/webhook"
echo ""
echo "‚ö†Ô∏è  –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ '–Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤' –æ—Å—Ç–∞–µ—Ç—Å—è:"
echo "   1. –ü—Ä–æ–≤–µ–¥–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –ø–ª–∞—Ç–µ–∂ –Ω–∞ 10+ —Ä—É–±–ª–µ–π –≤ –õ–ö Ozon –ë–∞–Ω–∫–∞"
echo "   2. –£–≤–µ–¥–æ–º–∏—Ç–µ —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫—É Ozon Pay –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —ç–∫–≤–∞–π—Ä–∏–Ω–≥–∞"
echo "   3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∫–ª—é—á–µ–π API –≤ –õ–ö" 